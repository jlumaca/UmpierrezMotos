{% extends "perfil_taller/padre_perfil_taller.html" %}
{% load static %}

{% block contenidoQueCambia %}
<style>
    form label {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

form label span {
    flex-grow: 1;
}

form label input[type="number"] {
    max-width: 100px;
    text-align: right;
}
</style>
<div class="table-container" id="inventarios">
    <div class="form-container" id="motoForm">
        <h2>Modificación de servicio</h4>
        {% if messages %}
        <div class="messages">
            <div class="alert alert alert-success">{{ message }}</div>
        </div>
        {% endif %}
        {% if error_message_cliente %}
        <div class="alert alert-danger" role="alert">
            {{ error_message_cliente }} <a href="{% url 'ClienteAlta' %}">aquí</a>
        </div>
        {% endif %}
        {% if error_message %}
        <div class="alert alert-danger" role="alert">
            {{ error_message }}
        </div>
        {% endif %}

        <!-- Formulario de búsqueda de cliente -->
       
        <form action="" enctype="multipart/form-data" method="POST">{% csrf_token %}
            <h4>Datos del cliente</h4>
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <th scope="row">Cliente</th>
                        <td>{{ cliente.nombre }} {{ cliente.apellido }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Documento</th>
                        <td>{{ cliente.documento }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Contacto</th>
                        <td>{{ tel1 }}{% if tel2 %}, {{ tel2 }}{% endif %}</td>
                    </tr>
                    <tr>
                        <th scope="row">Correo</th>
                        <td>{{ correo1 }}{% if correo2 %}, {{ correo2 }}{% endif %}</td>
                    </tr>
                    <tr>
                        <th scope="row">Domicilio</th>
                        <td>{{ cliente.domicilio }}</td>
                    </tr>
                </tbody>
            </table>

            <h4>Datos de la moto</h4>
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <th scope="row">Marca</th>
                        <td>{{ moto.marca }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Modelo</th>
                        <td>{{ moto.modelo }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Motor (cc)</th>
                        <td>{{ moto.motor }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Año</th>
                        <td>{{ moto.anio }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Número de motor</th>
                        <td>{{ moto.num_motor }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Número de chasis</th>
                        <td>{{ moto.num_chasis }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Matrícula</th>
                        <td>{{ matricula }}</td>
                    </tr>
                   
                </tbody>
            </table>    
            <h4>Servicios de mantenimiento realizados</h4>
            <div id="serviciosLista" class="mb-4">
                <p>LISTA CON LOS SERVICIOS YA REALIZADOS</p>
            </div>

            <h4>Servicios de mantenimiento pendientes</h4>
            <div id="serviciosLista" class="mb-4">
                <p>LISTA CON LOS SERVICIOS PENDIENTES</p>
            </div>

            <h4>Agregar más servicios de mantenimiento</h4>
            <div id="serviciosLista" class="mb-4">
                <p>LISTA CON MAS SERVICIOS POSIBLES</p>
            </div>

            <h4>Mecánicos asignados</h4>
            <div id="serviciosLista" class="mb-4">
                <p>LISTA CON MECANICOS ASIGNADOS AL SERVICIO</p>
            </div>

            <h4>Asignar más mecánicos al servicio</h4>
            <div id="serviciosLista" class="mb-4">
                <p>LISTA CON MECANICOS</p>
            </div>


            <h4>Actuaciones</h4>
            <div id="serviciosLista" class="mb-4">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Tarea</th>
                            <th>Fecha</th>
                            <th>Mecanico</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    <tr>
                        <td>se cambia la cadena por falla de fabrica</td>
                        <td>27 de diciembre</td>
                        <td>
                            Juan
                        </td>
                    </tr>
                    <tr>
                        <td>cambio de piñon</td>
                        <td>28 de diciembre</td>
                        <td>
                            Daniel
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
    
    <div class="mb-3">
        <label for="precio" class="form-label">Prioridad</label>
        <select class="form-control" name="prioridad">
            <option value="Alta">Alta</option>
            <option value="Media">Media</option>
            <option value="Baja">Baja</option>
        </select>
    </div>

    <div class="mb-3">
        <label for="precio" class="form-label">Fecha estimada</label>
        <input type="date" class="form-control" name="fecha_estimada" placeholder="Ingrese la fecha estimada de entrega de la moto" required>
    </div>

    <div class="mb-3">
        <label for="precio" class="form-label">Anotaciones</label>
        <textarea class="form-control" name="anotaciones" id="descripcion" placeholder="Anotaciones" rows="3"></textarea>
    </div>
    
    
    
            <button type="submit" class="btn btn-success">Guardar</button>
                <a href="{% url 'ServiciosEnGestion' %}" class="btn btn-secondary">Cancelar</a>
        </form>
        
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script>
    function agregarServicio() {
    // Contenedor donde se añaden los servicios
    const serviciosLista = document.getElementById("serviciosLista");

    // Crear un nuevo contenedor para el servicio
    const nuevoServicio = document.createElement("div");
    nuevoServicio.classList.add("d-flex", "align-items-center", "mb-2");

    // Crear el checkbox
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.name = "servicios[]";
    checkbox.value = ""; // El valor se completará dinámicamente
    checkbox.classList.add("me-2");

    // Crear el texto editable para el nombre del servicio
    const span = document.createElement("span");
    span.classList.add("flex-grow-1");
    span.contentEditable = true;
    span.textContent = "Nuevo servicio";

    // Crear el campo de entrada para el precio
    const inputPrecio = document.createElement("input");
    inputPrecio.type = "number";
    inputPrecio.name = ""; // El nombre se completará dinámicamente
    inputPrecio.classList.add("form-control", "w-auto", "ms-2");
    inputPrecio.placeholder = "Precio";
    inputPrecio.min = 0;
    inputPrecio.step = 0.01;

    // Agregar un evento para actualizar el valor y nombre del campo al editar el servicio
    span.addEventListener("input", () => {
        const textoServicio = span.textContent.trim().replaceAll(" ", "_");
        checkbox.value = textoServicio;
        inputPrecio.name = `precio_${textoServicio}`;
    });

    // Añadir los elementos al contenedor del nuevo servicio
    nuevoServicio.appendChild(checkbox);
    nuevoServicio.appendChild(span);
    nuevoServicio.appendChild(inputPrecio);

    // Añadir el nuevo servicio al formulario
    serviciosLista.appendChild(nuevoServicio);
}


</script>

{% endblock %}

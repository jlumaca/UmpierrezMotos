{% extends "perfil_taller/padre_perfil_taller.html" %}
{% load static %}

{% block contenidoQueCambia %}
<style>
    form label {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

form label span {
    flex-grow: 1;
}

form label input[type="number"] {
    max-width: 100px;
    text-align: right;
}
</style>
<div class="table-container" id="inventarios">
    <div class="form-container" id="motoForm">
        <h2>Modificaci√≥n de servicio</h4>
        {% if messages %}
        <div class="messages">
            <div class="alert alert alert-success">{{ message }}</div>
        </div>
        {% endif %}
        {% if error_message_cliente %}
        <div class="alert alert-danger" role="alert">
            {{ error_message_cliente }} <a href="{% url 'ClienteAlta' %}">aqu√≠</a>
        </div>
        {% endif %}
        {% if error_message %}
        <div class="alert alert-danger" role="alert">
            {{ error_message }}
        </div>
        {% endif %}

        <!-- Formulario de b√∫squeda de cliente -->
       
        <form action="" enctype="multipart/form-data" method="POST">{% csrf_token %}
            <h4>Datos del cliente</h4>
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <th scope="row">Cliente</th>
                        <td>{{ cliente.nombre }} {{ cliente.apellido }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Documento</th>
                        <td>{{ cliente.documento }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Contacto</th>
                        <td>{{ telefono }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Correo</th>
                        <td>{{ correo }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Domicilio</th>
                        <td>{{ cliente.domicilio }}</td>
                    </tr>
                </tbody>
            </table>

            <h4>Datos de la moto</h4>
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <th scope="row">Marca</th>
                        <td>{{ moto.marca }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Modelo</th>
                        <td>{{ moto.modelo }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Motor (cc)</th>
                        <td>{{ moto.motor }}</td>
                    </tr>
                    <tr>
                        <th scope="row">A√±o</th>
                        <td>{{ moto.anio }}</td>
                    </tr>
                    <tr>
                        <th scope="row">N√∫mero de motor</th>
                        <td>{{ moto.num_motor }}</td>
                    </tr>
                    <tr>
                        <th scope="row">N√∫mero de chasis</th>
                        <td>{{ moto.num_chasis }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Matr√≠cula</th>
                        <td>{{ matricula }}</td>
                    </tr>
                   
                </tbody>
            </table>    
            <h4>Servicios de mantenimiento realizados</h4>
            <div id="serviciosLista" class="mb-4">
                {% for servicio in tareas_realizadas %}
                    <div class="d-flex align-items-center mb-2">
                        <span class="flex-grow-1">{{ servicio.tarea }}</span>
                            <span class="text-success ms-2">‚úîÔ∏è</span>
                        
                    </div>
                {% endfor %}
            </div>
            
            

            <h4>Servicios de mantenimiento pendientes</h4>
            <div id="serviciosPendientes" class="mb-4">
                {% for servicio in tareas_pendientes %}
                    <label class="d-flex align-items-center mb-2">
                        <input type="checkbox" name="" value="{{ servicio.id }}" id="servicio6" class="me-2">
                        <span class="flex-grow-1">{{ servicio.tarea }}</span>
                    </label>
                {% endfor %}
            </div>

            <h4>Agregar m√°s servicios de mantenimiento</h4>
            <div id="serviciosLista" class="mb-4">
                <div class="d-flex">
            
                    <button type="button" id="agregar-servicio" class="btn btn-primary" onclick="agregarServicio()">Agregar</button>
                </div>
            </div>

            <!-- <h4>Mec√°nicos asignados</h4> -->
            <h4 class="mb-3">üîß Mec√°nicos Asignados</h4>
            <div id="serviciosLista" class="mb-4">
                <ul class="list-group">
                    {% for mecanico in mecanicos %}
                        <li class="list-group-item d-flex align-items-center">
                            <span class="me-2">üë∑‚Äç‚ôÇÔ∏è</span>
                            <span class="flex-grow-1">{{ mecanico.mecanico.nombre }} {{ mecanico.mecanico.apellido }}</span>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-muted">No hay mec√°nicos asignados a este servicio.</li>
                    {% endfor %}
                </ul>
            </div>
            

            <h4>Asignar m√°s mec√°nicos al servicio</h4>
            <div id="serviciosLista" class="mb-4">
                <p>LISTA CON MECANICOS</p>
            </div>


            <h4>Actuaciones</h4>
            <div id="serviciosLista" class="mb-4">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Tarea</th>
                            <th>Fecha</th>
                            <th>Mecanico</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    <tr>
                        <td>se cambia la cadena por falla de fabrica</td>
                        <td>27 de diciembre</td>
                        <td>
                            Juan
                        </td>
                    </tr>
                    <tr>
                        <td>cambio de pi√±on</td>
                        <td>28 de diciembre</td>
                        <td>
                            Daniel
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
    
    <div class="mb-3">
        <label for="precio" class="form-label">Prioridad</label>
        <select class="form-control" name="prioridad">
            <option value="Alta">Alta</option>
            <option value="Media">Media</option>
            <option value="Baja">Baja</option>
        </select>
    </div>

    <div class="mb-3">
        <label for="precio" class="form-label">Fecha estimada</label>
        <input type="date" class="form-control" name="fecha_estimada" placeholder="Ingrese la fecha estimada de entrega de la moto" required>
    </div>

    <div class="mb-3">
        <label for="precio" class="form-label">Anotaciones</label>
        <textarea class="form-control" name="anotaciones" id="descripcion" placeholder="Anotaciones" rows="3"></textarea>
    </div>
    
    
    
            <button type="submit" class="btn btn-success">Guardar</button>
                <a href="{% url 'ServiciosEnGestion' %}" class="btn btn-secondary">Cancelar</a>
        </form>
        
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script>
    function agregarServicio() {
    // Contenedor donde se a√±aden los servicios
    const serviciosLista = document.getElementById("serviciosPendientes");

    // Crear un nuevo contenedor para el servicio
    const nuevoServicio = document.createElement("div");
    nuevoServicio.classList.add("d-flex", "align-items-center", "mb-2");

    // Crear el checkbox
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.name = "servicios[]";
    checkbox.value = ""; // El valor se completar√° din√°micamente
    checkbox.classList.add("me-2");

    // Crear el texto editable para el nombre del servicio
    const span = document.createElement("span");
    span.classList.add("flex-grow-1");
    span.contentEditable = true;
    span.textContent = "Nuevo servicio";

    // Crear el campo de entrada para el precio
    const inputPrecio = document.createElement("input");
    inputPrecio.type = "number";
    inputPrecio.name = ""; // El nombre se completar√° din√°micamente
    inputPrecio.classList.add("form-control", "w-auto", "ms-2");
    inputPrecio.placeholder = "Precio";
    inputPrecio.min = 0;
    inputPrecio.step = 0.01;

    // Agregar un evento para actualizar el valor y nombre del campo al editar el servicio
    span.addEventListener("input", () => {
        const textoServicio = span.textContent.trim().replaceAll(" ", "_");
        checkbox.value = textoServicio;
        inputPrecio.name = `precio_${textoServicio}`;
    });

    // A√±adir los elementos al contenedor del nuevo servicio
    nuevoServicio.appendChild(checkbox);
    nuevoServicio.appendChild(span);
    nuevoServicio.appendChild(inputPrecio);

    // A√±adir el nuevo servicio al formulario
    serviciosLista.appendChild(nuevoServicio);
}


</script>

{% endblock %}
